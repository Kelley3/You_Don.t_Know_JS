
> # 词法作用域

* [词法阶段](#词法阶段)
* [欺骗阶段](#欺骗阶段)

### 词法阶段
`词法作用域`
* 意味着作用域是由书写代码时`变量和块的位置`决定的
* `编译`的`词法分析阶段`基本能够指导全部标识符在哪里以及时如何声明的，从而能够预测在`执行过程`中如何对它们进行查找

`查找`
* 作用域查找会在找到`第一个`匹配的标识符时停止
* 在多层的嵌套作用域中可以定义同名的标识符，这叫做`遮蔽效应`
* `全局变量会自动成为全局对象的属性`，通过这种技术可以访问那些被同名变量所遮蔽的全局变量
* 无论`函数`在哪里被调用，也无论它如何被调用，它`的词法作用域都只由函数声明时所处的位置决定`

### 欺骗阶段
欺骗词法作用域会导致`性能下降`，欺骗词法的两种机制

`eval`
* 对一段包含一个或多个声明的`代码字符串`进行演算，并借此来修改已经存在的词法作用域（在运行时）
* 通常被用来执行`动态创建的代码`

```JavaScript
function foo(str, a) {
  eval(str);  // 欺骗
  console.log(a, b);
}
var b = 2;
foo("var b = 3", 1);  // 1, 3
```

`with`
* 通过将一个对象的`引用`当作`作用域`来处理，将对象的`属性`当作`作用域中的标识符`来处理，从而创建了一个新的词法作用域（在运行时）

```JavaScript
function foo(obj) {
  with(obj) {
    a = 2;
  }
}

var o1 = {
  a: 3
};

var o2 = {
  b: 3
};

foo(o1);
console.log(o1.a);  // 2

foo(o2);
console.log(o2.a);  // undefined
console.log(a);     // 2 -- 不好，a 被泄漏到全局作用域上了
```
